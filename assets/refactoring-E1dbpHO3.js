import{r as y,j as e,c as $,R}from"./client-DD4c7S6m.js";const E=n=>n.product.discounts.filter(d=>n.quantity>=d.quantity),M=n=>n.length>0?Math.max(...n.map(d=>d.rate)):0,P=n=>{const d=E(n),c=M(d);return c?n.product.price*n.quantity*(1-c):n.product.price*n.quantity},B=(n,d)=>n.discountType==="amount"?d-n.discountValue:n.discountType==="percentage"?d*(1-n.discountValue/100):0,L=(n,d)=>{if(!d){const c=n.reduce((r,o)=>r+o.product.price*o.quantity,0),x=n.reduce((r,o)=>r+P(o),0);return{totalBeforeDiscount:c,totalAfterDiscount:x,totalDiscount:c-x}}if(d){const c=n.reduce((o,p)=>o+p.product.price*p.quantity,0),x=n.reduce((o,p)=>o+P(p),0),r=B(d,x);return{totalBeforeDiscount:c,totalAfterDiscount:r,totalDiscount:c-r}}return{totalBeforeDiscount:10,totalAfterDiscount:20,totalDiscount:30}},U=(n,d,c)=>c===0?n.filter(r=>r.product.id!==d):n.map(r=>r.product.id===d?{...r,quantity:c>r.product.stock?r.product.stock:c}:r),O=()=>{const[n,d]=y.useState([]),[c,x]=y.useState(null);return{cart:n,addToCart:h=>{d(N=>{const u=N.find(g=>g.product.id===h.id);if(u)return N.map(g=>g.product.id===u.product.id?{...g,quantity:g.quantity+1}:g);const f={product:h,quantity:1};return[...N,f]})},removeFromCart:h=>{d(N=>N.filter(u=>u.product.id!==h))},updateQuantity:(h,N)=>{d(u=>u.find(g=>g.product.id===h)?U(u,h,N):u)},applyCoupon:h=>{x(h)},calculateTotal:()=>L(n,c),selectedCoupon:c}},Q=n=>{const[d,c]=y.useState(()=>n);return{coupons:d,addCoupon:r=>{c(o=>[...o,r])}}},W=n=>{const[d,c]=y.useState(()=>n);return{products:d,updateProduct:o=>{c(p=>p.map(i=>i.id===o.id?{...o}:{...i}))},addProduct:o=>{c(p=>[...p,o])}}},_=({products:n,coupons:d})=>{const{cart:c,addToCart:x,removeFromCart:r,updateQuantity:o,applyCoupon:p,calculateTotal:i,selectedCoupon:b}=O(),h=s=>s.reduce((l,v)=>Math.max(l,v.rate),0),N=s=>{const l=c.find(v=>v.product.id===s.id);return s.stock-((l==null?void 0:l.quantity)||0)},{totalBeforeDiscount:u,totalAfterDiscount:f,totalDiscount:g}=i(),C=s=>{const{discounts:l}=s.product,{quantity:v}=s;let w=0;for(const k of l)v>=k.quantity&&(w=Math.max(w,k.rate));return w};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:n.map(s=>{const l=N(s);return e.jsxs("div",{"data-testid":`product-${s.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:s.name}),e.jsxs("span",{className:"text-gray-600",children:[s.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${l>0?"text-green-600":"text-red-600"}`,children:["재고: ",l,"개"]}),s.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대"," ",(h(s.discounts)*100).toFixed(0),"% 할인"]})]}),s.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:s.discounts.map((v,w)=>e.jsxs("li",{children:[v.quantity,"개 이상:"," ",(v.rate*100).toFixed(0),"% 할인"]},w))}),e.jsx("button",{onClick:()=>x(s),className:`w-full px-3 py-1 rounded ${l>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:l<=0,children:l>0?"장바구니에 추가":"품절"})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:c.map(s=>{const l=C(s);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:s.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.product.price,"원 x ",s.quantity,l>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(l*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>o(s.product.id,s.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>o(s.product.id,s.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>r(s.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},s.product.id)})}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:s=>p(d[parseInt(s.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),d.map((s,l)=>e.jsxs("option",{value:l,children:[s.name," -"," ",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`]},s.code))]}),b&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",b.name,"(",b.discountType==="amount"?`${b.discountValue}원`:`${b.discountValue}%`," ","할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",u.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",g.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",f.toLocaleString(),"원"]})]})]})]})]})]})},z=({products:n,coupons:d,onProductUpdate:c,onProductAdd:x,onCouponAdd:r})=>{const[o,p]=y.useState(new Set),[i,b]=y.useState(null),[h,N]=y.useState({quantity:0,rate:0}),[u,f]=y.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[g,C]=y.useState(!1),[s,l]=y.useState({name:"",price:0,stock:0,discounts:[]}),v=t=>{p(m=>{const a=new Set(m);return a.has(t)?a.delete(t):a.add(t),a})},w=t=>{b({...t})},k=(t,m)=>{if(i&&i.id===t){const a={...i,name:m};b(a)}},q=(t,m)=>{if(i&&i.id===t){const a={...i,price:m};b(a)}},S=()=>{i&&(c(i),b(null))},D=(t,m)=>{const a=n.find(j=>j.id===t);if(a){const j={...a,stock:m};c(j),b(j)}},A=t=>{const m=n.find(a=>a.id===t);if(m&&i){const a={...m,discounts:[...m.discounts,h]};c(a),b(a),N({quantity:0,rate:0})}},T=(t,m)=>{const a=n.find(j=>j.id===t);if(a){const j={...a,discounts:a.discounts.filter((K,F)=>F!==m)};c(j),b(j)}},I=()=>{r(u),f({name:"",code:"",discountType:"percentage",discountValue:0})},V=()=>{const t={...s,id:Date.now().toString()};x(t),l({name:"",price:0,stock:0,discounts:[]}),C(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>C(!g),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:g?"취소":"새 상품 추가"}),g&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:s.name,onChange:t=>l({...s,name:t.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:s.price,onChange:t=>l({...s,price:parseInt(t.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:s.stock,onChange:t=>l({...s,stock:parseInt(t.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:V,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),e.jsx("div",{className:"space-y-2",children:n.map((t,m)=>e.jsxs("div",{"data-testid":`product-${m+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>v(t.id),className:"w-full text-left font-semibold",children:[t.name," - ",t.price,"원 (재고: ",t.stock,")"]}),o.has(t.id)&&e.jsx("div",{className:"mt-2",children:i&&i.id===t.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:i.name,onChange:a=>k(t.id,a.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:i.price,onChange:a=>q(t.id,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:i.stock,onChange:a=>D(t.id,parseInt(a.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),i.discounts.map((a,j)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[a.quantity,"개 이상 구매 시 ",a.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>T(t.id,j),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},j)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:h.quantity,onChange:a=>N({...h,quantity:parseInt(a.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:h.rate*100,onChange:a=>N({...h,rate:parseInt(a.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>A(t.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:S,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[t.discounts.map((a,j)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[a.quantity,"개 이상 구매 시 ",a.rate*100,"% 할인"]})},j)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>w(t),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:u.name,onChange:t=>f({...u,name:t.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:u.code,onChange:t=>f({...u,code:t.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:u.discountType,onChange:t=>f({...u,discountType:t.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:u.discountValue,onChange:t=>f({...u,discountValue:parseInt(t.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:I,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:d.map((t,m)=>e.jsxs("div",{"data-testid":`coupon-${m+1}`,className:"bg-gray-100 p-2 rounded",children:[t.name," (",t.code,"):",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`," 할인"]},m))})]})]})]})]})]})},G=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],H=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],J=()=>{const{products:n,updateProduct:d,addProduct:c}=W(G),{coupons:x,addCoupon:r}=Q(H),[o,p]=y.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>p(!o),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:o?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:o?e.jsx(z,{products:n,coupons:x,onProductUpdate:d,onProductAdd:c,onCouponAdd:r}):e.jsx(_,{products:n,coupons:x})})]})};$.createRoot(document.getElementById("root")).render(e.jsx(R.StrictMode,{children:e.jsx(J,{})}));
